<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FocusED App</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<meta name="theme-color" content="#3b82f6">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}
body{min-height:100vh;display:flex;flex-direction:column;transition:.3s}
body.light{background:linear-gradient(135deg,#60a5fa,#3b82f6);color:#fff}
body.dark{background:#1f2937;color:#f3f4f6}
header{padding:20px;text-align:center;transition:.3s}
h1{font-size:36px;font-weight:800;animation:fadeInUp 0.7s}
.subtitle{opacity:.85;font-size:16px;animation:fadeInUp 1s}
.main-container{flex:1;display:flex;gap:20px;padding:20px;max-width:1400px;margin:auto;flex-wrap:wrap;transition:.3s}
.sidebar{flex:1 1 300px;display:flex;flex-direction:column;gap:20px}
.content{flex:2 1 600px;display:flex;flex-direction:column;gap:20px}
.card{background:rgba(255,255,255,.15);border-radius:20px;padding:20px;backdrop-filter:blur(12px);box-shadow:0 10px 25px rgba(0,0,0,.15);transition:.3s}
body.dark .card{background:rgba(31,41,55,.85);backdrop-filter:none;box-shadow:0 10px 25px rgba(0,0,0,.5)}
.card:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.25)}
.card-title{display:flex;align-items:center;font-size:20px;font-weight:700;margin-bottom:12px}
.material-icons-outlined{font-size:26px;margin-right:10px}
button{width:100%;padding:12px;margin-top:12px;font-size:16px;border:none;border-radius:12px;color:#fff;font-weight:600;background:linear-gradient(135deg,#3b82f6,#2563eb);cursor:pointer;transition:.25s}
button:hover{transform:scale(1.03);box-shadow:0 6px 15px rgba(0,0,0,.25)}
select,input{width:100%;padding:10px;border-radius:10px;border:none;margin-top:8px;font-size:16px}
a{cursor:pointer;text-decoration:underline;font-size:14px}
.popup{position:fixed;bottom:25px;right:25px;padding:15px 20px;border-radius:12px;display:none;font-size:16px;z-index:1000;animation:fadeIn .5s}
.popup.success{background:rgba(34,197,94,.9)}
.popup.warning{background:rgba(239,68,68,.9)}
.popup.info{background:rgba(59,130,246,.9)}
.progress-container{width:100%;background:rgba(255,255,255,.2);border-radius:12px;height:20px;margin-top:10px}
body.dark .progress-container{background:rgba(243,244,246,.2)}
.progress-bar{height:100%;background:#22c55e;width:0%;border-radius:12px;transition:.3s}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:900px){.main-container{flex-direction:column}}
.toggle-theme{position:fixed;top:20px;right:20px;background:#fff;color:#3b82f6;padding:8px 12px;border-radius:10px;cursor:pointer;z-index:1000}
body.dark .toggle-theme{background:#3b82f6;color:#fff}
</style>
</head>
<body class="light">

<div class="toggle-theme" onclick="toggleTheme()">ƒê·ªïi theme</div>

<header>
  <h1>FocusED</h1>
  <p class="subtitle">T·∫≠p trung ‚Äì T√≠ch ƒëi·ªÉm ‚Äì ƒê·ªïi th∆∞·ªüng ‚Äì N√¢ng k·ªπ nƒÉng</p>
</header>

<div class="main-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="card" id="auth-card">
      <div class="card-title"><span class="material-icons-outlined">person</span>ƒêƒÉng nh·∫≠p</div>
      <div id="login-form">
        <label>Email</label>
        <input type="email" id="login-email" placeholder="Nh·∫≠p email">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" id="login-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
        <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
        <p style="margin-top:10px;text-align:center;">Ch∆∞a c√≥ t√†i kho·∫£n? <a onclick="showRegister()">ƒêƒÉng k√Ω</a></p>
      </div>
      <div id="register-form" style="display:none">
        <label>Email</label>
        <input type="email" id="reg-email" placeholder="Nh·∫≠p email">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" id="reg-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
        <label>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
        <input type="password" id="reg-password2" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
        <label>T√™n hi·ªÉn th·ªã</label>
        <input type="text" id="reg-name" placeholder="T√™n c·ªßa b·∫°n">
        <button onclick="register()">ƒêƒÉng k√Ω</button>
        <p style="margin-top:10px;text-align:center;">ƒê√£ c√≥ t√†i kho·∫£n? <a onclick="showLogin()">ƒêƒÉng nh·∫≠p</a></p>
      </div>
    </div>

    <div class="card" id="user-stats" style="display:none">
      <div class="card-title"><span class="material-icons-outlined">account_circle</span>Xin ch√†o, <span id="user-name"></span></div>
      <button onclick="logout()">ƒêƒÉng xu·∫•t</button>
      <p>FP: <b id="fp">0</b></p>
      <p>Chu·ªói: <b id="chain">0 ph√∫t</b></p>
    </div>

    <div class="card" id="store-card" style="display:none">
      <div class="card-title"><span class="material-icons-outlined">store</span>C·ª≠a h√†ng Rewards</div>
      <div id="store"></div>
    </div>
  </div>

  <!-- Main content -->
  <div class="content" id="main-app" style="display:none">
    <div class="card">
      <div class="card-title"><span class="material-icons-outlined">timer</span>Ch·∫ø ƒê·ªô T·∫≠p Trung Nghi√™m</div>
      <label>M√¥n h·ªçc</label>
      <select id="subject">
        <option>To√°n Cao C·∫•p</option>
        <option>Lu·∫≠t Kinh Doanh</option>
        <option>Ti·∫øng Anh T·ªïng Qu√°t</option>
      </select>
      <label>Th·ªùi gian h·ªçc (ph√∫t)</label>
      <input id="minutes" type="number" min="1" value="25">
      <button onclick="startFocus()">B·∫Øt ƒë·∫ßu phi√™n t·∫≠p trung</button>
      <div class="progress-container">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
      <div style="margin-top:10px;font-size:14px;opacity:.8;">Lu·∫≠t: "Tho√°t l√† M·∫•t" ‚Äî r·ªùi tab ho·∫∑c m·ªü ·ª©ng d·ª•ng kh√°c s·∫Ω b·ªã h·ªßy v√† kh√¥ng ƒë∆∞·ª£c nh·∫≠n FP.</div>
    </div>

    <div class="card">
      <div class="card-title"><span class="material-icons-outlined">star</span>Focus Level & Tips</div>
      <p>Level m√¥n <b id="level-subject">-</b>: <b id="level">1</b></p>
      <ul id="tips"></ul>
    </div>

    <div class="card">
      <div class="card-title"><span class="material-icons-outlined">leaderboard</span>Leaderboard</div>
      <ol id="leaderboard">
        <li>Ch∆∞a c√≥ d·ªØ li·ªáu</li>
      </ol>
    </div>
  </div>
</div>

<div id="popup" class="popup"></div>

<script>
// --- Theme ---
function toggleTheme(){
  document.body.classList.toggle("dark");
  document.body.classList.toggle("light");
}

// --- Auth & storage ---
let user={name:"",email:""};
const usersKey="fe_users";
function showRegister(){document.getElementById("login-form").style.display="none";document.getElementById("register-form").style.display="block";}
function showLogin(){document.getElementById("login-form").style.display="block";document.getElementById("register-form").style.display="none";}

function login(){
  const email=document.getElementById("login-email").value.trim();
  const password=document.getElementById("login-password").value;
  if(!email||!password){showPopup("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin","warning");return;}
  let users=JSON.parse(localStorage.getItem(usersKey)||"{}");
  if(users[email] && users[email].password===password){
    user={...users[email]};
    localStorage.setItem("fe_user",JSON.stringify(user));
    loadUserData();
    showPopup("ƒêƒÉng nh·∫≠p th√†nh c√¥ng üéâ","success");
  }else{showPopup("Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng","warning");}
}

function register(){
  const email=document.getElementById("reg-email").value.trim();
  const password=document.getElementById("reg-password").value;
  const password2=document.getElementById("reg-password2").value;
  const name=document.getElementById("reg-name").value.trim();
  if(!email||!password||!password2||!name){showPopup("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin","warning");return;}
  if(password!==password2){showPopup("M·∫≠t kh·∫©u nh·∫≠p l·∫°i kh√¥ng kh·ªõp","warning");return;}
  let users=JSON.parse(localStorage.getItem(usersKey)||"{}");
  if(users[email]){showPopup("Email ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω","warning");return;}
  users[email]={email,password,name,fp:0,chain:0,subjectSeconds:{}};
  localStorage.setItem(usersKey,JSON.stringify(users));
  showPopup("ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p","success");
  showLogin();
}

function logout(){
  user={name:"",email:""};
  localStorage.removeItem("fe_user");
  document.getElementById("auth-card").style.display="block";
  document.getElementById("main-app").style.display="none";
  document.getElementById("user-stats").style.display="none";
  document.getElementById("store-card").style.display="none";
  showPopup("ƒê√£ ƒëƒÉng xu·∫•t","info");
}

function loadUserData(){
  document.getElementById("auth-card").style.display="none";
  document.getElementById("main-app").style.display="block";
  document.getElementById("user-stats").style.display="block";
  document.getElementById("store-card").style.display="block";
  document.getElementById("user-name").innerText=user.name;
  fp=user.fp||0;
  chainTime=user.chain||0;
  subjectSeconds=user.subjectSeconds||{};
  document.getElementById("fp").innerText=fp;
  document.getElementById("chain").innerText=chainTime+" ph√∫t";
  updateLevelTips();
  loadStore();
  updateLeaderboard();
}

// --- Focus session with progress ---
let fp=0,chainTime=0,timer,isFocusing=false,totalSeconds=0,subjectSeconds={};
function startFocus(){
  if(isFocusing){showPopup("Phi√™n ƒëang ch·∫°y","info");return;}
  const mins=parseInt(document.getElementById("minutes").value);
  const subject=document.getElementById("subject").value;
  isFocusing=true;
  let secondsLeft=mins*60;
  totalSeconds=0;
  showPopup("B·∫°n ƒëang t·∫≠p trung m√¥n: "+subject,"info");
  const progressBar=document.getElementById("progress-bar");
  progressBar.style.width="0%";
  timer=setInterval(()=>{
    secondsLeft--;
    totalSeconds++;
    subjectSeconds[subject]=(subjectSeconds[subject]||0)+1;
    const percent=Math.floor(totalSeconds/(mins*60)*100);
    progressBar.style.width=percent+"%";
    updateLevelTips();
    if(document.hidden){endSession(false);}
    if(secondsLeft<=0){endSession(true);}
  },1000);
}

function endSession(success){
  clearInterval(timer);
  isFocusing=false;
  const progressBar=document.getElementById("progress-bar");
  progressBar.style.width="0%";
  if(success){
    const gained=Math.floor(totalSeconds/60);
    fp+=gained;
    chainTime+=gained;
    showPopup("Ho√†n th√†nh! +"+gained+" FP üéâ","success");
  }else{
    chainTime=0;
    showPopup("Phi√™n h·ªçc b·ªã h·ªßy ‚ùå","warning");
  }
  document.getElementById("fp").innerText=fp;
  document.getElementById("chain").innerText=chainTime+" ph√∫t";
  saveUserData();
  updateLeaderboard();
}

// --- Level & Tips with level up notification ---
let lastLevel=0;
function updateLevelTips(){
  const subject=document.getElementById("subject").value;
  const secs=subjectSeconds[subject]||0;
  const level=Math.floor(secs/300)+1;
  document.getElementById("level").innerText=level;
  document.getElementById("level-subject").innerText=subject;
  if(level>lastLevel){showPopup("Level m·ªõi ƒë·∫°t: "+level+" üéâ","success"); lastLevel=level;}
  const tips=[];
  if(level>=5) tips.push("M·∫πo: L·∫≠p l·ªãch √¥n t·∫≠p 2 ng√†y/7 ng√†y.");
  if(level>=10) tips.push("M·∫πo n√¢ng cao: Ph∆∞∆°ng ph√°p Feynman.");
  if(level>=20) tips.push("T√†i li·ªáu chuy√™n s√¢u: S√°ch & kh√≥a h·ªçc n√¢ng cao.");
  const tipsEl=document.getElementById("tips");
  tipsEl.innerHTML="";
  tips.forEach(t=>{const li=document.createElement("li");li.innerText=t;tipsEl.appendChild(li)});
}

// --- Leaderboard th·∫≠t ---
function updateLeaderboard(){
  let users=JSON.parse(localStorage.getItem(usersKey)||"{}");
  let lbArr=Object.values(users).sort((a,b)=>b.fp-a.fp).slice(0,10);
  const lb=document.getElementById("leaderboard");
  lb.innerHTML="";
  lbArr.forEach(u=>{
    const li=document.createElement("li");
    li.innerText=u.name+" - "+u.fp+" FP";
    if(u.email===user.email) li.style.fontWeight="bold";
    lb.appendChild(li);
  });
}

// --- Store ---
let storeItems=[
  {id:1,title:"Voucher s√°ch - 50 FP",cost:50,desc:"Voucher gi·∫£m gi√° s√°ch"},
  {id:2,title:"Theme ƒë·ªôc quy·ªÅn - 20 FP",cost:20,desc:"M·ªü kh√≥a theme m·ªõi"},
  {id:3,title:"Focus Music Premium - 100 FP",cost:100,desc:"M·ªü kh√≥a playlist"},
  {id:4,title:"ƒê√≥ng g√≥p thi·ªán nguy·ªán - 10 FP",cost:10,desc:"Quy ƒë·ªïi FP th√†nh ƒë√≥ng g√≥p x√£ h·ªôi"}
];

function loadStore(){
  const storeEl=document.getElementById("store");
  storeEl.innerHTML="";
  storeItems.forEach(item=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<b>${item.title}</b><br><span style="font-size:14px;opacity:.8">${item.desc}</span><br><button>ƒê·ªïi ${item.cost} FP</button>`;
    div.querySelector("button").onclick=()=>{
      if(fp<item.cost){showPopup("B·∫°n kh√¥ng ƒë·ªß FP","warning");return;}
      fp-=item.cost;
      document.getElementById("fp").innerText=fp;
      saveUserData();
      showPopup("ƒê√£ ƒë·ªïi "+item.title,"success");
      updateLeaderboard();
    };
    storeEl.appendChild(div);
  });
}

// --- L∆∞u d·ªØ li·ªáu user ---
function saveUserData(){
  let users=JSON.parse(localStorage.getItem(usersKey)||"{}");
  user.fp=fp;
  user.chain=chainTime;
  user.subjectSeconds=subjectSeconds;
  users[user.email]=user;
  localStorage.setItem(usersKey,JSON.stringify(users));
  localStorage.setItem("fe_user",JSON.stringify(user));
}

// --- Popup ---
function showPopup(msg,type="info"){
  const p=document.getElementById("popup");
  p.innerText=msg;
  p.className="popup "+type;
  p.style.display="block";
  setTimeout(()=>p.style.display="none",3000);
}

// --- M·∫•t t·∫≠p trung: r·ªùi tab / blur ---
document.addEventListener("visibilitychange",()=>{if(isFocusing&&document.hidden){endSession(false);}});
window.addEventListener("blur",()=>{if(isFocusing){endSession(false);}});

// --- load user n·∫øu l∆∞u ---
window.onload=function(){
  const saved=JSON.parse(localStorage.getItem("fe_user"));
  if(saved){user=saved;loadUserData();}
}
</script>

</body>
</html>
